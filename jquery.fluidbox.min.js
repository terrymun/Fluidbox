function whichTransitionEvent(){var t,i=document.createElement("fakeelement"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in e)if(void 0!==i.style[t])return e[t]}!function(t,i){var e=function(t,i,e){var a;return function(){function n(){e||t.apply(o,d),a=null}var o=this,d=arguments;a?clearTimeout(a):e&&t.apply(o,d),a=setTimeout(n,i||100)}};jQuery.fn[i]=function(t){return t?this.bind("resize",e(t)):this.trigger(i)}}(jQuery,"smartresize");var customTransitionEnd=whichTransitionEvent();!function(t){var i=0;t.fn.fluidbox=function(e){var a=t.extend(!0,{viewportFill:.95,debounceResize:!0,stackIndex:1e3,stackIndexDelta:10,closeTrigger:[{selector:".fluidbox-overlay",event:"click"},{selector:"document",event:"keyup",keyCode:27}],immediateOpen:!1,loadingEle:!0,lazyLoadAll:!1},e),n=["keyup","keydown","keypress"];a.stackIndex<a.stackIndexDelta&&(a.stackIndexDelta=a.stackIndex),$fbOverlay=t("<div />",{"class":"fluidbox-overlay",css:{"z-index":a.stackIndex}});var o,d=this,s=t(window),l=function(i){t(i+".fluidbox-opened").trigger("click")},r=function(i,e){var n=i.find("img").first(),d=i.find(".fluidbox-ghost"),l=i.find(".fluidbox-loader"),r=i.find(".fluidbox-wrap"),f=i.data(),c=0,g=0;n.data().imgRatio=f.natWidth/f.natHeight,o>n.data().imgRatio?(c=f.natHeight<s.height()*a.viewportFill?f.natHeight:s.height()*a.viewportFill,f.imgScale=c/n.height(),f.imgScaleY=f.imgScale,f.imgScaleX=f.natWidth*(n.height()*f.imgScaleY/f.natHeight)/n.width()):(g=f.natWidth<s.width()*a.viewportFill?f.natWidth:s.width()*a.viewportFill,f.imgScale=g/n.width(),f.imgScaleX=f.imgScale,f.imgScaleY=f.natHeight*(n.width()*f.imgScaleX/f.natWidth)/n.height());var h=s.scrollTop()-n.offset().top+.5*n.data("imgHeight")*(n.data("imgScale")-1)+.5*(s.height()-n.data("imgHeight")*n.data("imgScale")),u=.5*n.data("imgWidth")*(n.data("imgScale")-1)+.5*(s.width()-n.data("imgWidth")*n.data("imgScale"))-n.offset().left,p=parseInt(1e3*f.imgScaleX)/1e3+","+parseInt(1e3*f.imgScaleY)/1e3;d.add(l).css({transform:"translate("+parseInt(10*u)/10+"px,"+parseInt(10*h)/10+"px) scale("+p+")",top:n.offset().top-r.offset().top,left:n.offset().left-r.offset().left}),d.one(customTransitionEnd,function(){t.each(e,function(t,e){i.trigger(e)})})},f=function(t){function i(){r.imgWidth=e.width(),r.imgHeight=e.height(),r.imgRatio=e.width()/e.height(),n.add(d).css({width:e.width(),height:e.height(),top:e.offset().top-l.offset().top+parseInt(e.css("borderTopWidth"))+parseInt(e.css("paddingTop")),left:e.offset().left-l.offset().left+parseInt(e.css("borderLeftWidth"))+parseInt(e.css("paddingLeft"))}),r.imgScale=o>r.imgRatio?s.height()*a.viewportFill/e.height():s.width()*a.viewportFill/e.width()}if(o=s.width()/s.height(),t.hasClass("fluidbox")){var e=t.find("img").first(),n=t.find(".fluidbox-ghost"),d=t.find(".fluidbox-loader"),l=t.find(".fluidbox-wrap"),r=e.data();i(),e.load(i)}},c=function(i){if(t(this).hasClass("fluidbox")){var e=t(this),n=t(this).find("img").first(),o=t(this).find(".fluidbox-ghost"),d=t(this).find(".fluidbox-loader"),s=t(this).find(".fluidbox-wrap"),l=encodeURI(e.attr("href")),f={},c=function(){e.trigger("openstart"),e.append($fbOverlay).data("fluidbox-state",1).removeClass("fluidbox-closed").addClass("fluidbox-opened"),f.close&&window.clearTimeout(f.close),f.open=window.setTimeout(function(){t(".fluidbox-overlay").css({opacity:1})},10),t(".fluidbox-wrap").css({zIndex:a.stackIndex-a.stackIndexDelta-1}),s.css({"z-index":a.stackIndex+a.stackIndexDelta})},g=function(){e.trigger("closestart"),e.data("fluidbox-state",0).removeClass("fluidbox-opened fluidbox-loaded fluidbox-loading").addClass("fluidbox-closed"),f.open&&window.clearTimeout(f.open),f.close=window.setTimeout(function(){t(".fluidbox-overlay").remove(),s.css({"z-index":a.stackIndex-a.stackIndexDelta})},10),t(".fluidbox-overlay").css({opacity:0}),o.add(d).css({transform:"translate(0,0) scale(1,1)",opacity:0,top:n.offset().top-s.offset().top+parseInt(n.css("borderTopWidth"))+parseInt(n.css("paddingTop")),left:n.offset().left-s.offset().left+parseInt(n.css("borderLeftWidth"))+parseInt(n.css("paddingLeft"))}),o.one(customTransitionEnd,function(){e.trigger("closeend")}),n.css({opacity:1})};0!==t(this).data("fluidbox-state")&&t(this).data("fluidbox-state")?g():(e.addClass("fluidbox-loading"),n.css({opacity:0}),o.css({"background-image":"url("+n.attr("src")+")",opacity:1}),a.immediateOpen?(e.data("natWidth",n[0].naturalWidth).data("natHeight",n[0].naturalHeight),c(),r(e,["openend"]),t("<img />",{src:l}).load(function(){e.trigger("imageloaddone").trigger("delayedloaddone").removeClass("fluidbox-loading").addClass("fluidbox-loaded").data("natWidth",t(this)[0].naturalWidth).data("natHeight",t(this)[0].naturalHeight),o.css({"background-image":"url("+l+")"}),r(e,["delayedreposdone"])}).error(function(){e.trigger("imageloadfail"),g()})):t("<img />",{src:l}).load(function(){e.trigger("imageloaddone").removeClass("fluidbox-loading").addClass("fluidbox-loaded").data("natWidth",t(this)[0].naturalWidth).data("natHeight",t(this)[0].naturalHeight),a.immediateOpen=!0,o.css({"background-image":"url("+l+")"}),c(),r(e,["openend"])}).error(function(){e.trigger("imageloadfail"),g()})),i.preventDefault()}},g=function(i){i?f(i):d.each(function(){f(t(this))});var e=t("a.fluidbox.fluidbox-opened");e.length>0&&r(e,["resizeend"])};return a.debounceResize?t(window).smartresize(function(){g()}):t(window).resize(function(){g()}),d.each(function(){if(t(this).is("a")&&1===t(this).children().length&&t(this).children().is("img")&&"none"!==t(this).css("display")&&"none"!==t(this).parents().css("display")){var e=function(e){var o=t("<div />",{"class":"fluidbox-wrap",css:{"z-index":a.stackIndex-a.stackIndexDelta}}),d=t("<div />",{"class":"fluidbox-loader"});i+=1;var r=t(e);r.addClass("fluidbox fluidbox-closed").attr("id","fluidbox-"+i).wrapInner(o).find("img").first().css({opacity:1}).after('<div class="fluidbox-ghost" />').each(function(){var i=t(this);i.width()>0&&i.height()>0?(f(r),r.click(c)):i.load(function(){f(r),r.click(c),r.trigger("thumbloaddone")}).error(function(){r.trigger("thumbloadfail")})}),a.loadingEle&&r.find(".fluidbox-ghost").after(d),t(e).on("recompute",function(){g(t(this)),t(this).trigger("recomputeend")});var h="#fluidbox-"+i;a.closeTrigger&&t.each(a.closeTrigger,function(i){var e=a.closeTrigger[i];"window"!=e.selector?"document"==e.selector&&(e.keyCode&&n.indexOf(e.event)>-1?t(document).on(e.event,function(t){t.keyCode==e.keyCode&&l(h)}):t(document).on(e.event,h,function(){l(h)})):s.on(e.event,function(){l(h)})})};$fbImg=t(this).children(),window.lazySizesConfig&&a.lazyLoadAll?($fbImg.addClass(window.lazySizesConfig.lazyClass||"lazyload"),$fbImg.attr("data-src",t(this).attr("href")),t(this).on("lazybeforeunveil",function(){e(this)})):e(this)}}),d}}(jQuery);